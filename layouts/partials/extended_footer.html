<!-- SVG Lightbox: click any SVG image to expand with pan/zoom -->
<script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
<style>
  .post-content img[src$=".svg"],
  .index-content img[src$=".svg"] {
    cursor: pointer;
    transition: opacity 0.15s;
  }
  .post-content img[src$=".svg"]:hover,
  .index-content img[src$=".svg"]:hover { opacity: 0.85; }
  .svg-lightbox {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.88); z-index: 9999;
    display: flex; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.2s;
  }
  .svg-lightbox.active { opacity: 1; }
  .svg-lightbox-inner {
    width: 92vw; height: 88vh; background: #0f172a;
    border-radius: 12px; position: relative; overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  }
  .svg-lightbox-inner svg { width: 100% !important; height: 100% !important; max-width: none !important; }
  .svg-lightbox-controls {
    position: absolute; top: 12px; right: 12px; display: flex; gap: 6px; z-index: 10;
  }
  .svg-lightbox-controls button {
    background: rgba(0,0,0,0.6); color: #fff; border: none; border-radius: 8px;
    width: 36px; height: 36px; font-size: 18px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s;
  }
  .svg-lightbox-controls button:hover { background: rgba(0,0,0,0.85); }
  .svg-lightbox-hint {
    position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.5); color: #94a3b8; border-radius: 6px;
    padding: 6px 14px; font-size: 12px; pointer-events: none;
  }
  .svg-lightbox-title {
    position: absolute; top: 14px; left: 16px;
    color: #94a3b8; font-size: 13px; z-index: 10;
  }
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.post-content img[src$=".svg"], .index-content img[src$=".svg"]').forEach(img => {
    img.title = 'Click to expand';

    img.addEventListener('click', () => {
      const overlay = document.createElement('div');
      overlay.className = 'svg-lightbox';

      const alt = img.alt || 'SVG Diagram';
      overlay.innerHTML = `
        <div class="svg-lightbox-inner">
          <div class="svg-lightbox-title">${alt}</div>
          <div class="svg-lightbox-controls">
            <button data-action="zoomin" title="Zoom in">+</button>
            <button data-action="zoomout" title="Zoom out">&minus;</button>
            <button data-action="reset" title="Reset view">\u21BA</button>
            <button data-action="close" title="Close (Esc)">&times;</button>
          </div>
          <div class="svg-lightbox-svg" style="width:100%;height:100%;"></div>
          <div class="svg-lightbox-hint">Scroll to zoom &middot; Drag to pan &middot; Esc to close</div>
        </div>
      `;

      const svgContainer = overlay.querySelector('.svg-lightbox-svg');
      document.body.appendChild(overlay);

      fetch(img.src)
        .then(r => r.text())
        .then(svgText => {
          svgContainer.innerHTML = svgText;
          const svgEl = svgContainer.querySelector('svg');
          if (!svgEl) return;
          svgEl.style.maxWidth = 'none';
          svgEl.removeAttribute('width');
          svgEl.removeAttribute('height');

          requestAnimationFrame(() => {
            overlay.classList.add('active');
            const pz = svgPanZoom(svgEl, {
              zoomEnabled: true, controlIconsEnabled: false,
              fit: true, center: true,
              minZoom: 0.3, maxZoom: 20,
              zoomScaleSensitivity: 0.3,
              mouseWheelZoomEnabled: true,
              dblClickZoomEnabled: true,
            });

            const close = () => {
              overlay.classList.remove('active');
              setTimeout(() => { pz.destroy(); overlay.remove(); }, 200);
            };

            overlay.querySelector('[data-action="close"]').addEventListener('click', close);
            overlay.querySelector('[data-action="zoomin"]').addEventListener('click', () => pz.zoomIn());
            overlay.querySelector('[data-action="zoomout"]').addEventListener('click', () => pz.zoomOut());
            overlay.querySelector('[data-action="reset"]').addEventListener('click', () => { pz.resetZoom(); pz.center(); });
            overlay.addEventListener('click', e => { if (e.target === overlay) close(); });
            document.addEventListener('keydown', function esc(e) {
              if (e.key === 'Escape') { close(); document.removeEventListener('keydown', esc); }
            });
          });
        });
    });
  });
});
</script>
