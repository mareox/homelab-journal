<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 420" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="cfGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f6821f;stop-opacity:0.12"/>
      <stop offset="100%" style="stop-color:#f6821f;stop-opacity:0.04"/>
    </linearGradient>
    <linearGradient id="trustGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e;stop-opacity:0.10"/>
      <stop offset="100%" style="stop-color:#22c55e;stop-opacity:0.04"/>
    </linearGradient>
    <linearGradient id="untrustedGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ef4444;stop-opacity:0.08"/>
      <stop offset="100%" style="stop-color:#ef4444;stop-opacity:0.03"/>
    </linearGradient>
    <filter id="shadow" x="-2%" y="-2%" width="104%" height="108%">
      <feDropShadow dx="0" dy="1" stdDeviation="2" flood-opacity="0.10"/>
    </filter>

    <!-- Icon symbols -->
    <symbol id="icon-cloud" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z"/>
    </symbol>
    <symbol id="icon-shield" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
    </symbol>
    <symbol id="icon-lock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="11" width="18" height="11" rx="2"/>
      <path d="M7 11V7a5 5 0 0110 0v4"/>
    </symbol>
  </defs>

  <!-- Background -->
  <rect width="800" height="420" rx="8" fill="#0f172a"/>

  <!-- Title -->
  <text x="400" y="32" text-anchor="middle" fill="#e2e8f0" font-size="16" font-weight="600">Trust Boundaries — CF-Connecting-IP Header Flow</text>

  <!-- Untrusted zone -->
  <rect x="20" y="50" width="200" height="350" rx="8" fill="url(#untrustedGrad)" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="6,3" opacity="0.9"/>
  <text x="120" y="74" text-anchor="middle" fill="#fca5a5" font-size="11" font-weight="600" letter-spacing="0.5">UNTRUSTED</text>

  <!-- Cloudflare zone -->
  <rect x="240" y="50" width="200" height="350" rx="8" fill="url(#cfGrad)" stroke="#f6821f" stroke-width="1.5" opacity="0.9"/>
  <use href="#icon-cloud" x="248" y="58" width="16" height="16" color="#fdba74"/>
  <text x="340" y="74" text-anchor="middle" fill="#fdba74" font-size="11" font-weight="600" letter-spacing="0.5">CLOUDFLARE</text>

  <!-- Trusted zone -->
  <rect x="460" y="50" width="320" height="350" rx="8" fill="url(#trustGrad)" stroke="#22c55e" stroke-width="1.5" opacity="0.9"/>
  <use href="#icon-shield" x="468" y="58" width="16" height="16" color="#86efac"/>
  <text x="620" y="74" text-anchor="middle" fill="#86efac" font-size="11" font-weight="600" letter-spacing="0.5">TRUSTED (YOUR INFRASTRUCTURE)</text>

  <!-- External User box -->
  <rect x="50" y="120" width="140" height="54" rx="6" fill="#1e293b" stroke="#64748b" stroke-width="1" filter="url(#shadow)"/>
  <text x="120" y="144" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="500">External User</text>
  <text x="120" y="162" text-anchor="middle" fill="#94a3b8" font-size="10">IP: 203.0.113.50</text>

  <!-- Internal User box -->
  <rect x="50" y="300" width="140" height="54" rx="6" fill="#1e293b" stroke="#64748b" stroke-width="1" filter="url(#shadow)"/>
  <text x="120" y="324" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="500">Internal User</text>
  <text x="120" y="342" text-anchor="middle" fill="#94a3b8" font-size="10">IP: 10.x.x.50</text>

  <!-- CF Edge box -->
  <rect x="270" y="110" width="140" height="50" rx="6" fill="#431407" stroke="#f6821f" stroke-width="1.2" filter="url(#shadow)"/>
  <use href="#icon-cloud" x="276" y="117" width="14" height="14" color="#fdba74"/>
  <text x="348" y="134" text-anchor="middle" fill="#fed7aa" font-size="13" font-weight="600">CF Edge</text>
  <text x="340" y="150" text-anchor="middle" fill="#fdba74" font-size="9">Overwrites header</text>

  <!-- CF Tunnel box -->
  <rect x="270" y="195" width="140" height="50" rx="6" fill="#431407" stroke="#f6821f" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="340" y="219" text-anchor="middle" fill="#fed7aa" font-size="13" font-weight="600">CF Tunnel</text>
  <text x="340" y="235" text-anchor="middle" fill="#fdba74" font-size="9">Passes header through</text>

  <!-- Caddy HA box -->
  <rect x="490" y="295" width="140" height="54" rx="6" fill="#052e16" stroke="#22c55e" stroke-width="1.2" filter="url(#shadow)"/>
  <text x="560" y="319" text-anchor="middle" fill="#bbf7d0" font-size="13" font-weight="600">Caddy HA</text>
  <text x="560" y="337" text-anchor="middle" fill="#86efac" font-size="9">Sets CF-Connecting-IP</text>

  <!-- Vaultwarden box -->
  <rect x="640" y="185" width="120" height="70" rx="6" fill="#052e16" stroke="#4ade80" stroke-width="1.5" filter="url(#shadow)"/>
  <use href="#icon-lock" x="647" y="192" width="14" height="14" color="#4ade80"/>
  <text x="700" y="212" text-anchor="middle" fill="#bbf7d0" font-size="13" font-weight="700">Vaultwarden</text>
  <text x="700" y="230" text-anchor="middle" fill="#86efac" font-size="9">Reads header:</text>
  <text x="700" y="244" text-anchor="middle" fill="#4ade80" font-size="9" font-weight="600">CF-Connecting-IP</text>

  <!-- Arrow: External User → CF Edge -->
  <line x1="190" y1="140" x2="265" y2="135" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#arrowGray)"/>

  <!-- Arrow: CF Edge → CF Tunnel -->
  <line x1="340" y1="160" x2="340" y2="190" stroke="#f6821f" stroke-width="1.5" marker-end="url(#arrowOrange)"/>

  <!-- Arrow: CF Tunnel → Vaultwarden -->
  <line x1="410" y1="220" x2="635" y2="220" stroke="#f6821f" stroke-width="1.5" marker-end="url(#arrowOrange)"/>

  <!-- Arrow: Internal User → Caddy -->
  <line x1="190" y1="327" x2="485" y2="322" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#arrowGray)"/>

  <!-- Arrow: Caddy → Vaultwarden -->
  <path d="M 630 310 Q 660 290 670 255" fill="none" stroke="#22c55e" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

  <!-- Header labels on arrows -->
  <rect x="440" y="197" width="170" height="18" rx="3" fill="#1e293b" opacity="0.85"/>
  <text x="525" y="210" text-anchor="middle" fill="#fdba74" font-size="9" font-weight="500">CF-Connecting-IP: 203.0.113.50</text>

  <rect x="250" y="168" width="100" height="16" rx="3" fill="#1e293b" opacity="0.85"/>
  <text x="300" y="179" text-anchor="middle" fill="#f6821f" font-size="8">Sets header ↓</text>

  <rect x="630" y="275" width="120" height="16" rx="3" fill="#1e293b" opacity="0.85"/>
  <text x="690" y="286" text-anchor="middle" fill="#86efac" font-size="8" font-weight="500">CF-Connecting-IP</text>

  <!-- Firewall indicator -->
  <line x1="460" y1="55" x2="460" y2="395" stroke="#22c55e" stroke-width="2" stroke-dasharray="3,6" opacity="0.4"/>
  <rect x="448" y="365" width="24" height="24" rx="3" fill="#052e16" stroke="#22c55e" stroke-width="1" opacity="0.8"/>
  <use href="#icon-shield" x="450" y="367" width="20" height="20" color="#4ade80"/>

  <!-- Legend -->
  <rect x="22" y="383" width="8" height="8" rx="2" fill="#ef4444" opacity="0.5"/>
  <text x="34" y="391" fill="#94a3b8" font-size="9">Cannot spoof header</text>

  <rect x="148" y="383" width="8" height="8" rx="2" fill="#f6821f" opacity="0.7"/>
  <text x="160" y="391" fill="#94a3b8" font-size="9">CF sets/preserves header</text>

  <rect x="298" y="383" width="8" height="8" rx="2" fill="#22c55e" opacity="0.7"/>
  <text x="310" y="391" fill="#94a3b8" font-size="9">Trusted to set header</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowGray" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/>
    </marker>
    <marker id="arrowOrange" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#f6821f"/>
    </marker>
    <marker id="arrowGreen" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#22c55e"/>
    </marker>
  </defs>
</svg>
